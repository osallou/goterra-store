language: go
sudo: false
matrix:
  include:
  - go: 1.x
    env: LATEST=true
  - go: 1.10.x
  - go: 1.11.x
script:
- go vet
- go test -v ./...
- if [ "${LATEST}" = "true" ]; then GOOS=linux GOARCH=amd64 go build -ldflags "-X
  main.Version=`git rev-parse --short HEAD`" -o goterra.linux.amd64 goterra.go; fi
- if [ "${LATEST}" = "true" ]; then GOOS=darwin GOARCH=amd64 go build -ldflags "-X
  main.Version=`git rev-parse --short HEAD`" -o goterra.darwin.amd64 goterra.go; fi
- if [ "${LATEST}" = "true" ]; then GOOS=windows GOARCH=amd64 go build -ldflags "-X
  main.Version=`git rev-parse --short HEAD`" -o goterra.windows.amd64.exe goterra.go;
  fi
- if [ "${LATEST}" = "true" ]; then GOOS=linux GOARCH=amd64 go build -ldflags "-X
  main.Version=`git rev-parse --short HEAD`" -o goterra-cli.linux.amd64 cmd/goterra-cli.go;
  fi
- if [ "${LATEST}" = "true" ]; then GOOS=darwin GOARCH=amd64 go build -ldflags "-X
  main.Version=`git rev-parse --short HEAD`" -o goterra-cli.darwin.amd64 cmd/goterra-cli.go;
  fi
- if [ "${LATEST}" = "true" ]; then GOOS=windows GOARCH=amd64 go build -ldflags "-X
  main.Version=`git rev-parse --short HEAD`" -o goterra-cli.windows.amd64.exe cmd/goterra-cli.go;
  fi
deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: BoL/n3mT0C7ypbsifaeJsHv7bJiNp1nlr9kqPlo9Twl95lHEPdiyAY7MdOfuufW+IIiDhmgghPsCNcJMCArIvicAAH1JyKy6aLCqoN1pejZKxcSVHxbY34aZKr3v91pr49Tyl+BXnPw6s3JgyJ/UIVYZjFucOZpL+c9kF9REUwSoYxZqte+pJ+N1ZPjSNY0VouBlCYJqxBrP1PdZpZTxeGTiZGsKw9gU+UGdF6+rQWBCH5VeqcaHyLQfYLsDMwz5riL+9hKvs9DAatLkOk81GGaAaRHJxY61dGjptpoHx2zdlCbJPZIw1dh4/YxRaEyPrAb8TBNKqm6rbf0lOysBvJ4jmyfDqutnLrnGauDfxUy+FivuzxzkYryH+goGmUFNrxeNc73706sDYO1ouD+ts1gpnRRR2KbB9KR3naE6HK09jLZN5iIXaciqi95DJ0SKCK9wNN89YU1i/nuIqUAMydzrMRKUPgOup7ATlevroNVJ4VjR6gwZVmTrfWiDcJe0Ll+sfizDrzw8XAza+wZowGyB33goeZpVOgwZJ0WKD4zyAAhhzy55mP9gzKZo/yIBJcSzAsSebUa9dGFbyH1NqFjyCFirFwhCxx0+YwoEBL/L7LvkWpAXmYzmCrECESCAmaURs37a7hprIeJkfWFt1JTuG7EKjBix1KYyRN0EffY=
  file:
          - goterra.linux.amd64
          - goterra-cli.linux.amd64
          - goterra.darwin.amd64
          - goterra-cli.darwin.amd64
          - goterra.windows.amd64.exe
          - goterra-cli.windows.amd64.exe
  on:
    repo: osallou/goterra
    tags: true
